<%
/**
 * ====================================================================================
 * TEMPLATE: Object Model
 * ====================================================================================
 * 
 * PURPOSE: Generates class files for core Newgrounds.io object models.
 * 
 * WHAT ARE OBJECTS?: Objects represent data structures returned by the API, such as:
 * - Medal: Represents an achievement/trophy
 * - User: Represents a Newgrounds user
 * - Score: Represents a scoreboard entry
 * - SaveSlot: Represents a cloud save slot
 * 
 * AVAILABLE VARIABLES:
 * - model: Object containing all properties and metadata for this object
 * - model.name: The name of the object (e.g., "Medal", "User")
 * - model.description: Human-readable description of what this object represents
 * - model.properties: Object containing all properties this object has
 * - helpers: Your custom helper methods (from helpers.js)
 * - partial: Methods to include partial templates (partial.get, partial.getIfExists)
 * - config: Your full config object with all settings
 * 
 * EJS DOCUMENTATION: https://ejs.co/
 * 
 * ====================================================================================
 */

// COMMENT: Prepare data structures we'll need while generating this class
// NOTE: Filter out 'error' property because it's now inherited from BaseObject
// All BaseObject subclasses (objects, components, results) have error defined at the base level
const propertyNames = Object.keys(model.properties).filter(prop => prop !== 'error');
const requiredParams = [];
const hasProperties = propertyNames.length > 0;
const className = helpers.getClassName(model.name);
%>

/**
 * <%- className %>
 * 
 * <%- model.description %>
 */
package io.newgrounds.models.objects {
	
	import io.newgrounds.BaseObject;
<%- partial.getIfExists(`objects/${model.name}/imports`) -%>
	
	public class <%- className %> extends BaseObject {
		
		//==================== PROPERTIES ====================
		
<% if (hasProperties) { -%>
<%   for (let propertyName of propertyNames) { -%>
<%     if (model.properties[propertyName].required) requiredParams.push(propertyName); -%>
		/**
		 * <%- model.properties[propertyName].description %>
		 */
		public var <%- propertyName %>:<%- helpers.getDataType(model.properties[propertyName]) %> = <%- helpers.getDefaultValue(model.properties[propertyName]) %>;
		
<%   } -%>
<% } -%>
<%- partial.getIfExists(`objects/${model.name}/properties`) -%>
		
		//==================== CONSTRUCTOR ====================
		
		public function <%- className %>() {
			super();
		}
		
		//==================== ABSTRACT PROPERTY OVERRIDES ====================
		
		/**
		 * Object name for debugging and type checking
		 */
		override public function get objectName():String {
			return "<%- model.name %>";
		}
		
		/**
		 * Object type identifier
		 */
		override public function get objectType():String {
			return "object";
		}
		
		/**
		 * All property names for this object
		 */
		override public function get propertyNames():Array {
			return <%- JSON.stringify(propertyNames) %>;
		}
		
		/**
		 * Required properties for validation
		 */
		override public function get requiredProperties():Array {
			return <%- JSON.stringify(requiredParams) %>;
		}
		
		/**
		 * Type casting map for deserializing properties
		 */
		override public function get castTypes():Object {
			return {
<% if (hasProperties) { -%>
<%   let isFirst = true; -%>
<%   for (let propertyName of propertyNames) { -%>
<%     const prop = model.properties[propertyName]; -%>
<%     let castValue = "null"; -%>
<%     if (prop.object && prop.array) { -%>
<%       castValue = `"array-of-${prop.object}"`; -%>
<%     } else if (prop.object) { -%>
<%       castValue = `"${prop.object}"`; -%>
<%     } else if (prop.array) { -%>
<%       castValue = "\"Array\""; -%>
<%     } -%>
<%     if (castValue !== "null") { -%>
<%       if (!isFirst) { %>,
<%       } -%>
				"<%- propertyName %>": <%- castValue %><%       isFirst = false; -%>
<%     } -%>
<%   } -%>
<%   if (!isFirst) { %>
<%   } -%>
<% } -%>
			};
		}
		
		//==================== CUSTOM METHODS ====================
<%- partial.getIfExists(`objects/${model.name}/methods`) -%>
	}
}
